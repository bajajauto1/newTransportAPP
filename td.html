<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Bajaj Auto Chakan 1 - Transport</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #f3f4f6;
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Custom Scrollbar for better UI */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

    /* Shift Button Styling */
    .shift-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .shiftBtn {
      border: 1px solid #e5e7eb;
      transition: all 0.2s ease;
    }

    .activeShift {
      background: #2563eb !important;
      color: white !important;
      border-color: #1d4ed8;
      transform: scale(0.98);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .blurOther { opacity: 0.5; filter: grayscale(0.5); }

    /* Card Styling */
    .entry-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      border: 1px solid #edf2f7;
    }

    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 50;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }
    
    /* Modal Transition */
    .modal-active { display: flex !important; animation: fadeIn 0.2s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body class="pb-24">

  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b px-4 py-3 flex items-center justify-between">
    <div class="flex items-center space-x-2">
      <img src="download (1).png" alt="Logo" class="h-8 w-auto">
      <span class="font-bold text-blue-900 tracking-tight">PLANT-1</span>
    </div>
    <div class="flex items-center space-x-2">
      <span id="adminBadge" class="hidden px-2 py-0.5 rounded-full bg-green-100 text-green-700 text-[10px] font-bold uppercase">Admin</span>
      <button id="loginBtn" class="text-xs font-semibold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg">Login</button>
      <button id="logoutBtn" class="hidden text-xs font-semibold text-red-600 bg-red-50 px-3 py-1.5 rounded-lg">Logout</button>
    </div>
  </header>

  <div class="max-w-md mx-auto p-4">

    <div class="shift-grid mb-6">
      <button class="shiftBtn card px-3 py-2.5 rounded-xl bg-white text-xs font-semibold" data-shift="sunday1">Sun - 1st</button>
      <button class="shiftBtn card px-3 py-2.5 rounded-xl bg-white text-xs font-semibold" data-shift="sunday2">Sun - 2nd</button>
      <button class="shiftBtn card px-3 py-2.5 rounded-xl bg-white text-xs font-semibold" data-shift="sunday3">Sun - 3rd</button>
      <button class="shiftBtn card px-3 py-2.5 rounded-xl bg-white text-xs font-semibold" data-shift="nextweek1">NextW - 1st</button>
      <button class="shiftBtn card px-4 py-3 rounded bg-white shadow text-left" data-shift="nextweek2">Next Week â€“ 2nd Shift</button>
Â  Â  Â  <button class="shiftBtn card px-4 py-3 rounded bg-white shadow text-left" data-shift="nextweek3">Next Week â€“ 3rd Shift</button>
Â  Â  Â  <button class="shiftBtn card px-4 py-3 rounded bg-white shadow text-left" data-shift="ot">OT (Overtime)</button>
Â  Â  Â  <button class="shiftBtn card px-4 py-3 rounded bg-white shadow text-left" data-shift="vendor">Vendor Visit</button>
    </div>

    <details class="mb-6 bg-white rounded-xl border border-gray-200 overflow-hidden">
        <summary class="p-4 font-bold text-gray-700 cursor-pointer list-none flex justify-between items-center">
            <span>ðŸ“Ž Important Links</span>
            <span class="text-gray-400 text-xs">View All</span>
        </summary>
        <div class="p-4 pt-0 grid grid-cols-1 gap-2 border-t">
            <a href="https://bajajauto1.github.io/EmergencyContacts/" class="flex items-center p-2 text-sm text-red-600 font-bold bg-red-50 rounded-lg">ðŸš¨ Emergency Contact</a>
            <a href="https://bajajauto1.github.io/buspassonline/" class="flex items-center p-2 text-sm text-blue-700 bg-blue-50 rounded-lg">ðŸšŒ Download Bus Pass</a>
            <a href="http://qrco.de/bgQ34j" class="flex items-center p-2 text-sm text-gray-700 bg-gray-50 rounded-lg">ðŸ“˜ Shuttle Timings</a>
        </div>
    </details>

    <h2 id="shiftTitle" class="text-xl font-bold text-gray-800 mb-4 px-1">Select Shift</h2>

    <div id="supervisorArea" class="hidden mb-6 p-4 bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl shadow-lg text-white flex justify-between items-center">
      <div>
        <div class="text-[10px] uppercase tracking-wider opacity-80">Shift Supervisor</div>
        <div id="supervisorText" class="font-bold text-lg leading-tight"></div>
      </div>
      <a id="supervisorCall" href="#" class="h-12 w-12 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-sm border border-white/30">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
        </svg>
      </a>
    </div>

    <div id="listArea">
      <div id="entriesBody" class="space-y-3"></div>
      <div id="emptyMsg" class="text-center py-12">
        <div class="text-gray-300 mb-2">ðŸ“­</div>
        <p class="text-gray-500 text-sm">No entries found for this shift.</p>
      </div>
    </div>
  </div>

  <button id="addEntryBtn" class="hidden fab h-14 w-14 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-xl active:scale-90 transition-transform">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
    </svg>
  </button>

  <div id="modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 items-end sm:items-center justify-center">
    <div class="bg-white rounded-t-3xl sm:rounded-2xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
      <h3 id="modalTitle" class="text-xl font-bold mb-4">Add Entry</h3>
      <form id="entryForm" class="space-y-3">
        <div class="grid grid-cols-2 gap-3">
          <input required name="routeNo" placeholder="Route No." class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
          <input required name="routeName" placeholder="Route Name" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
        </div>
        <input name="stops" placeholder="Stops (Stop A, Stop B...)" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
        <div class="grid grid-cols-2 gap-3">
          <input name="driverName" placeholder="Driver Name" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
          <input name="driverPhone" type="tel" placeholder="Driver Phone" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
        </div>
        <div class="grid grid-cols-2 gap-3">
          <input name="date" type="date" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
          <input name="supervisorName" placeholder="Supervisor" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
        </div>
        <input name="supervisorPhone" placeholder="Supervisor Phone" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" />
        
        <div class="flex space-x-3 pt-4">
          <button type="button" id="cancelModal" class="flex-1 p-3 rounded-xl bg-gray-100 font-semibold">Cancel</button>
          <button type="submit" class="flex-1 p-3 rounded-xl bg-blue-600 text-white font-semibold">Save Entry</button>
        </div>
      </form>
    </div>
  </div>

  <div id="loginModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 items-center justify-center p-6">
    <div class="bg-white rounded-2xl w-full max-w-xs p-6 shadow-2xl">
      <h3 class="text-lg font-bold mb-4">Admin Login</h3>
      <form id="loginForm" class="space-y-3">
        <input id="email" type="email" placeholder="Email" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" required />
        <input id="password" type="password" placeholder="Password" class="p-3 bg-gray-50 border rounded-xl w-full text-sm" required />
        <div class="flex space-x-2 pt-2">
          <button type="button" id="cancelLogin" class="flex-1 p-2 rounded-lg bg-gray-100 text-sm">Back</button>
          <button type="submit" class="flex-1 p-2 rounded-lg bg-blue-600 text-white text-sm">Sign In</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // --- Config & Init ---
    const firebaseConfig = {
      apiKey: "AIzaSyBs8aGN5M4xER3rydVPuu_fUGwH6Z85Ios",
      authDomain: "studio-6630380513-11e8c.firebaseapp.com",
      databaseURL: "https://studio-6630380513-11e8c-default-rtdb.firebaseio.com",
      projectId: "studio-6630380513-11e8c",
      storageBucket: "studio-6630380513-11e8c.firebasestorage.app",
      messagingSenderId: "545650500301",
      appId: "1:545650500301:web:157ab1ab6570936779ff84"
    };
    const ADMIN_EMAIL = "mr.vishnu4312@gmail.com";
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // --- Selectors ---
    const shiftButtons = document.querySelectorAll('.shiftBtn');
    const shiftTitle = document.getElementById('shiftTitle');
    const addEntryBtn = document.getElementById('addEntryBtn');
    const entriesBody = document.getElementById('entriesBody');
    const emptyMsg = document.getElementById('emptyMsg');
    const modal = document.getElementById('modal');
    const entryForm = document.getElementById('entryForm');
    const supervisorArea = document.getElementById('supervisorArea');

    let currentShift = null;
    let currentEntries = {};
    let editingId = null;

    function isAdmin() { return auth.currentUser && auth.currentUser.email.toLowerCase() === ADMIN_EMAIL.toLowerCase(); }
    function telLink(phone) { return phone ? 'tel:' + phone.replace(/\s+/g, '') : '#'; }

    // --- Render Logic (Optimized for Mobile Cards) ---
    function renderEntriesCards(data) {
      entriesBody.innerHTML = '';
      const keys = Object.keys(data || {});
      if (!keys.length) { emptyMsg.classList.remove('hidden'); return; }
      emptyMsg.classList.add('hidden');

      keys.sort((a,b)=>((Number(data[a].routeNo)||0) - (Number(data[b].routeNo)||0))).forEach(id => {
        const e = data[id];
        const card = document.createElement('div');
        card.className = 'entry-card';
        card.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div>
              <span class="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded">ROUTE ${e.routeNo || '??'}</span>
              <h3 class="text-lg font-bold text-gray-800 mt-1">${e.routeName || 'No Name'}</h3>
            </div>
            <a href="${telLink(e.driverPhone)}" class="bg-green-500 text-white p-3 rounded-full shadow-lg active:scale-90 transition-transform">
               <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
               </svg>
            </a>
          </div>
          <div class="text-xs text-gray-500 mb-3 space-y-1">
            <p class="flex items-center"><span class="w-16 font-semibold">Driver:</span> ${e.driverName || 'N/A'}</p>
            <p class="flex items-start"><span class="w-16 font-semibold">Stops:</span> <span class="flex-1">${(e.stops || []).join(', ')}</span></p>
          </div>
          <div class="flex justify-between items-center pt-3 border-t border-gray-50">
            <span class="text-[10px] text-gray-400 font-medium italic">Update: ${e.date || '---'}</span>
            ${isAdmin() ? `
              <div class="flex space-x-2">
                <button data-id="${id}" class="editBtn text-xs font-bold text-blue-600 px-3 py-1 bg-blue-50 rounded-lg">Edit</button>
                <button data-id="${id}" class="delBtn text-xs font-bold text-red-600 px-3 py-1 bg-red-50 rounded-lg">Delete</button>
              </div>
            ` : ''}
          </div>
        `;
        entriesBody.appendChild(card);
      });

      document.querySelectorAll('.editBtn').forEach(b => b.addEventListener('click', () => openEdit(b.dataset.id)));
      document.querySelectorAll('.delBtn').forEach(b => b.addEventListener('click', () => deleteEntry(b.dataset.id)));
    }

    // --- Core Logic ---
    shiftButtons.forEach(btn => btn.addEventListener('click', () => {
      shiftButtons.forEach(b => { b.classList.remove('activeShift'); b.classList.add('blurOther'); });
      btn.classList.add('activeShift');
      btn.classList.remove('blurOther');

      const shift = btn.dataset.shift;
      currentShift = shift;
      shiftTitle.textContent = btn.textContent;

      db.ref('shifts/' + shift + '/supervisor').on('value', snap => {
        const sup = snap.val();
        if(sup && (sup.name || sup.phone)) {
          supervisorArea.classList.remove('hidden');
          document.getElementById('supervisorText').textContent = sup.name || 'Supervisor';
          document.getElementById('supervisorCall').href = telLink(sup.phone);
        } else supervisorArea.classList.add('hidden');
      });

      db.ref('shifts/' + shift + '/entries').on('value', snap => {
        currentEntries = snap.val() || {};
        renderEntriesCards(currentEntries);
      });
    }));

    function openEdit(id) {
      const e = currentEntries[id] || {};
      editingId = id;
      document.getElementById('modalTitle').textContent = 'Edit Entry';
      entryForm.routeNo.value = e.routeNo || '';
      entryForm.routeName.value = e.routeName || '';
      entryForm.stops.value = (e.stops || []).join(', ');
      entryForm.driverName.value = e.driverName || '';
      entryForm.driverPhone.value = e.driverPhone || '';
      entryForm.date.value = e.date || '';
      modal.classList.add('modal-active');
    }

    function deleteEntry(id) {
      if(confirm('Delete this entry?')) db.ref('shifts/'+currentShift+'/entries/'+id).remove();
    }

    // --- Modal Controls ---
    addEntryBtn.addEventListener('click', () => { editingId = null; document.getElementById('modalTitle').textContent = 'New Entry'; entryForm.reset(); modal.classList.add('modal-active'); });
    document.getElementById('cancelModal').addEventListener('click', () => modal.classList.remove('modal-active'));

    entryForm.addEventListener('submit', e => {
      e.preventDefault();
      const fd = new FormData(entryForm);
      const obj = {
        routeNo: fd.get('routeNo'),
        routeName: fd.get('routeName'),
        stops: fd.get('stops').split(',').map(s => s.trim()).filter(Boolean),
        driverName: fd.get('driverName'),
        driverPhone: fd.get('driverPhone'),
        date: fd.get('date')
      };
      const updates = {};
      if(fd.get('supervisorName')) updates['shifts/'+currentShift+'/supervisor'] = { name: fd.get('supervisorName'), phone: fd.get('supervisorPhone') };
      if(editingId) updates['shifts/'+currentShift+'/entries/'+editingId] = obj;
      else updates['shifts/'+currentShift+'/entries/' + db.ref().push().key] = obj;

      db.ref().update(updates).then(() => modal.classList.remove('modal-active')).catch(alert);
    });

    // --- Auth Logic ---
    document.getElementById('loginBtn').addEventListener('click', () => document.getElementById('loginModal').classList.add('modal-active'));
    document.getElementById('cancelLogin').addEventListener('click', () => document.getElementById('loginModal').classList.remove('modal-active'));
    document.getElementById('logoutBtn').addEventListener('click', () => auth.signOut());

    document.getElementById('loginForm').addEventListener('submit', e => {
      e.preventDefault();
      auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
        .then(() => document.getElementById('loginModal').classList.remove('modal-active'))
        .catch(err => alert(err.message));
    });

    auth.onAuthStateChanged(user => {
      const isAdm = user && user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase();
      document.getElementById('adminBadge').classList.toggle('hidden', !isAdm);
      addEntryBtn.classList.toggle('hidden', !isAdm);
      document.getElementById('loginBtn').classList.toggle('hidden', !!user);
      document.getElementById('logoutBtn').classList.toggle('hidden', !user);
      if(currentEntries) renderEntriesCards(currentEntries);
    });

    // Default init
    window.onload = () => { document.querySelector('.shiftBtn').click(); };
  </script>
</body>
</html>